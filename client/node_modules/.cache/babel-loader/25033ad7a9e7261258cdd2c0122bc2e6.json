{"ast":null,"code":"var _jsxFileName = \"/Users/gabrieldsilva/Library/Mobile Documents/com~apple~CloudDocs/Documents/code/dev/volmate/client/src/pages/Profile/index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useRef } from 'react';\nimport { FiUser, FiMail, FiLock, FiArrowLeft } from 'react-icons/fi';\nimport { Form } from '@unform/web';\nimport * as Yup from 'yup';\nimport { Link, useHistory } from 'react-router-dom';\nimport api from '../../services/api';\nimport { useToast } from '../../hooks/toast';\nimport getValidationErrors from '../../utils/getValidationErrors';\nimport Input from '../../components/Input';\nimport Button from '../../components/Button';\nimport { Container, Content } from './styles';\nimport { useAuth } from '../../hooks/auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Profile = () => {\n  _s();\n\n  const formRef = useRef(null);\n  const {\n    addToast\n  } = useToast();\n  const history = useHistory();\n  const {\n    user,\n    updateUser\n  } = useAuth();\n  const handleSubmit = useCallback(async data => {\n    try {\n      var _formRef$current;\n\n      (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.setErrors({});\n      const schema = Yup.object().shape({\n        name: Yup.string().required('Name mandatory'),\n        email: Yup.string().email('Insert a valid email').required('E-mail mandatory'),\n        old_password: Yup.string(),\n        password: Yup.string().when('old_password', {\n          is: val => !!val.length,\n          then: Yup.string().required('Mandatory field'),\n          otherwise: Yup.string()\n        }),\n        password_confirmation: Yup.string().when('old_password', {\n          is: val => !!val.length,\n          then: Yup.string().required('Mandatory field'),\n          otherwise: Yup.string()\n        }).oneOf([Yup.ref('password'), undefined], 'Passwords must match')\n      });\n      await schema.validate(data, {\n        abortEarly: false\n      });\n      const {\n        name,\n        email,\n        old_password,\n        password,\n        password_confirmation\n      } = data;\n      const formData = {\n        name,\n        email,\n        ...(data.old_password ? {\n          old_password,\n          password,\n          password_confirmation\n        } : {})\n      };\n      const response = await api.put('/profile', formData);\n      updateUser(response.data);\n      history.push('/');\n      addToast({\n        type: 'success',\n        title: 'Profile updated successfully!',\n        description: 'Your new settings have been saved'\n      });\n    } catch (err) {\n      if (err instanceof Yup.ValidationError) {\n        var _formRef$current2;\n\n        const errors = getValidationErrors(err);\n        (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.setErrors(errors);\n        return;\n      }\n\n      addToast({\n        type: 'error',\n        title: 'Update error',\n        description: 'An error occurred while trying to update your profile, please try again.'\n      });\n    }\n  }, [addToast, history, updateUser]);\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/dashboard\",\n          children: /*#__PURE__*/_jsxDEV(FiArrowLeft, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Content, {\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        ref: formRef,\n        initialData: {\n          name: user.name,\n          email: user.email\n        },\n        onSubmit: handleSubmit,\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"My profile\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          name: \"name\",\n          icon: FiUser,\n          placeholder: \"Name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          name: \"email\",\n          icon: FiMail,\n          placeholder: \"E-mail\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          containerStyle: {\n            marginTop: 24\n          },\n          name: \"old_password\",\n          icon: FiLock,\n          type: \"password\",\n          placeholder: \"Current password\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          name: \"password\",\n          icon: FiLock,\n          type: \"password\",\n          placeholder: \"New password\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          name: \"password_confirmation\",\n          icon: FiLock,\n          type: \"password\",\n          placeholder: \"Password confirmation\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          type: \"submit\",\n          children: \"Confirm changes\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Profile, \"0+KNRkycdnxImjydqG51N3wy5Yk=\", false, function () {\n  return [useToast, useHistory, useAuth];\n});\n\n_c = Profile;\nexport default Profile;\n\nvar _c;\n\n$RefreshReg$(_c, \"Profile\");","map":{"version":3,"sources":["/Users/gabrieldsilva/Library/Mobile Documents/com~apple~CloudDocs/Documents/code/dev/volmate/client/src/pages/Profile/index.tsx"],"names":["React","useCallback","useRef","FiUser","FiMail","FiLock","FiArrowLeft","Form","Yup","Link","useHistory","api","useToast","getValidationErrors","Input","Button","Container","Content","useAuth","Profile","formRef","addToast","history","user","updateUser","handleSubmit","data","current","setErrors","schema","object","shape","name","string","required","email","old_password","password","when","is","val","length","then","otherwise","password_confirmation","oneOf","ref","undefined","validate","abortEarly","formData","response","put","push","type","title","description","err","ValidationError","errors","marginTop"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,WAAhB,EAA6BC,MAA7B,QAA2C,OAA3C;AACA,SAASC,MAAT,EAAiBC,MAAjB,EAAyBC,MAAzB,EAAiCC,WAAjC,QAAoD,gBAApD;AAEA,SAASC,IAAT,QAAqB,aAArB;AACA,OAAO,KAAKC,GAAZ,MAAqB,KAArB;AACA,SAASC,IAAT,EAAeC,UAAf,QAAiC,kBAAjC;AAEA,OAAOC,GAAP,MAAgB,oBAAhB;AAEA,SAASC,QAAT,QAAyB,mBAAzB;AAEA,OAAOC,mBAAP,MAAgC,iCAAhC;AAEA,OAAOC,KAAP,MAAkB,wBAAlB;AACA,OAAOC,MAAP,MAAmB,yBAAnB;AAEA,SAASC,SAAT,EAAoBC,OAApB,QAAmC,UAAnC;AACA,SAASC,OAAT,QAAwB,kBAAxB;;;AAUA,MAAMC,OAAiB,GAAG,MAAM;AAAA;;AAC9B,QAAMC,OAAO,GAAGlB,MAAM,CAAc,IAAd,CAAtB;AACA,QAAM;AAAEmB,IAAAA;AAAF,MAAeT,QAAQ,EAA7B;AACA,QAAMU,OAAO,GAAGZ,UAAU,EAA1B;AAEA,QAAM;AAAEa,IAAAA,IAAF;AAAQC,IAAAA;AAAR,MAAuBN,OAAO,EAApC;AAEA,QAAMO,YAAY,GAAGxB,WAAW,CAC9B,MAAOyB,IAAP,IAAiC;AAC/B,QAAI;AAAA;;AACF,0BAAAN,OAAO,CAACO,OAAR,sEAAiBC,SAAjB,CAA2B,EAA3B;AAEA,YAAMC,MAAM,GAAGrB,GAAG,CAACsB,MAAJ,GAAaC,KAAb,CAAmB;AAChCC,QAAAA,IAAI,EAAExB,GAAG,CAACyB,MAAJ,GAAaC,QAAb,CAAsB,gBAAtB,CAD0B;AAEhCC,QAAAA,KAAK,EAAE3B,GAAG,CAACyB,MAAJ,GACJE,KADI,CACE,sBADF,EAEJD,QAFI,CAEK,kBAFL,CAFyB;AAKhCE,QAAAA,YAAY,EAAE5B,GAAG,CAACyB,MAAJ,EALkB;AAMhCI,QAAAA,QAAQ,EAAE7B,GAAG,CAACyB,MAAJ,GAAaK,IAAb,CAAkB,cAAlB,EAAkC;AAC1CC,UAAAA,EAAE,EAAGC,GAAD,IAAc,CAAC,CAACA,GAAG,CAACC,MADkB;AAE1CC,UAAAA,IAAI,EAAElC,GAAG,CAACyB,MAAJ,GAAaC,QAAb,CAAsB,iBAAtB,CAFoC;AAG1CS,UAAAA,SAAS,EAAEnC,GAAG,CAACyB,MAAJ;AAH+B,SAAlC,CANsB;AAWhCW,QAAAA,qBAAqB,EAAEpC,GAAG,CAACyB,MAAJ,GACpBK,IADoB,CACf,cADe,EACC;AACpBC,UAAAA,EAAE,EAAGC,GAAD,IAAc,CAAC,CAACA,GAAG,CAACC,MADJ;AAEpBC,UAAAA,IAAI,EAAElC,GAAG,CAACyB,MAAJ,GAAaC,QAAb,CAAsB,iBAAtB,CAFc;AAGpBS,UAAAA,SAAS,EAAEnC,GAAG,CAACyB,MAAJ;AAHS,SADD,EAMpBY,KANoB,CAMd,CAACrC,GAAG,CAACsC,GAAJ,CAAQ,UAAR,CAAD,EAAsBC,SAAtB,CANc,EAMoB,sBANpB;AAXS,OAAnB,CAAf;AAoBA,YAAMlB,MAAM,CAACmB,QAAP,CAAgBtB,IAAhB,EAAsB;AAC1BuB,QAAAA,UAAU,EAAE;AADc,OAAtB,CAAN;AAIA,YAAM;AACJjB,QAAAA,IADI;AAEJG,QAAAA,KAFI;AAGJC,QAAAA,YAHI;AAIJC,QAAAA,QAJI;AAKJO,QAAAA;AALI,UAMFlB,IANJ;AAQA,YAAMwB,QAAQ,GAAG;AACflB,QAAAA,IADe;AAEfG,QAAAA,KAFe;AAGf,YAAIT,IAAI,CAACU,YAAL,GACA;AACEA,UAAAA,YADF;AAEEC,UAAAA,QAFF;AAGEO,UAAAA;AAHF,SADA,GAMA,EANJ;AAHe,OAAjB;AAYA,YAAMO,QAAQ,GAAG,MAAMxC,GAAG,CAACyC,GAAJ,CAAQ,UAAR,EAAoBF,QAApB,CAAvB;AAEA1B,MAAAA,UAAU,CAAC2B,QAAQ,CAACzB,IAAV,CAAV;AAEAJ,MAAAA,OAAO,CAAC+B,IAAR,CAAa,GAAb;AAEAhC,MAAAA,QAAQ,CAAC;AACPiC,QAAAA,IAAI,EAAE,SADC;AAEPC,QAAAA,KAAK,EAAE,+BAFA;AAGPC,QAAAA,WAAW,EAAE;AAHN,OAAD,CAAR;AAKD,KA1DD,CA0DE,OAAOC,GAAP,EAAY;AACZ,UAAIA,GAAG,YAAYjD,GAAG,CAACkD,eAAvB,EAAwC;AAAA;;AACtC,cAAMC,MAAM,GAAG9C,mBAAmB,CAAC4C,GAAD,CAAlC;AAEA,6BAAArC,OAAO,CAACO,OAAR,wEAAiBC,SAAjB,CAA2B+B,MAA3B;AAEA;AACD;;AAEDtC,MAAAA,QAAQ,CAAC;AACPiC,QAAAA,IAAI,EAAE,OADC;AAEPC,QAAAA,KAAK,EAAE,cAFA;AAGPC,QAAAA,WAAW,EACT;AAJK,OAAD,CAAR;AAMD;AACF,GA5E6B,EA6E9B,CAACnC,QAAD,EAAWC,OAAX,EAAoBE,UAApB,CA7E8B,CAAhC;AAgFA,sBACE,QAAC,SAAD;AAAA,4BACE;AAAA,6BACE;AAAA,+BACE,QAAC,IAAD;AAAM,UAAA,EAAE,EAAC,YAAT;AAAA,iCACE,QAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YADF,eASE,QAAC,OAAD;AAAA,6BACE,QAAC,IAAD;AACE,QAAA,GAAG,EAAEJ,OADP;AAEE,QAAA,WAAW,EAAE;AACXY,UAAAA,IAAI,EAAET,IAAI,CAACS,IADA;AAEXG,UAAAA,KAAK,EAAEZ,IAAI,CAACY;AAFD,SAFf;AAME,QAAA,QAAQ,EAAEV,YANZ;AAAA,gCAQE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBARF,eAUE,QAAC,KAAD;AAAO,UAAA,IAAI,EAAC,MAAZ;AAAmB,UAAA,IAAI,EAAEtB,MAAzB;AAAiC,UAAA,WAAW,EAAC;AAA7C;AAAA;AAAA;AAAA;AAAA,gBAVF,eAYE,QAAC,KAAD;AAAO,UAAA,IAAI,EAAC,OAAZ;AAAoB,UAAA,IAAI,EAAEC,MAA1B;AAAkC,UAAA,WAAW,EAAC;AAA9C;AAAA;AAAA;AAAA;AAAA,gBAZF,eAcE,QAAC,KAAD;AACE,UAAA,cAAc,EAAE;AAAEwD,YAAAA,SAAS,EAAE;AAAb,WADlB;AAEE,UAAA,IAAI,EAAC,cAFP;AAGE,UAAA,IAAI,EAAEvD,MAHR;AAIE,UAAA,IAAI,EAAC,UAJP;AAKE,UAAA,WAAW,EAAC;AALd;AAAA;AAAA;AAAA;AAAA,gBAdF,eAsBE,QAAC,KAAD;AACE,UAAA,IAAI,EAAC,UADP;AAEE,UAAA,IAAI,EAAEA,MAFR;AAGE,UAAA,IAAI,EAAC,UAHP;AAIE,UAAA,WAAW,EAAC;AAJd;AAAA;AAAA;AAAA;AAAA,gBAtBF,eA6BE,QAAC,KAAD;AACE,UAAA,IAAI,EAAC,uBADP;AAEE,UAAA,IAAI,EAAEA,MAFR;AAGE,UAAA,IAAI,EAAC,UAHP;AAIE,UAAA,WAAW,EAAC;AAJd;AAAA;AAAA;AAAA;AAAA,gBA7BF,eAoCE,QAAC,MAAD;AAAQ,UAAA,IAAI,EAAC,QAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBApCF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YATF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAoDD,CA3ID;;GAAMc,O;UAEiBP,Q,EACLF,U,EAEaQ,O;;;KALzBC,O;AA6IN,eAAeA,OAAf","sourcesContent":["import React, { useCallback, useRef } from 'react';\nimport { FiUser, FiMail, FiLock, FiArrowLeft } from 'react-icons/fi';\nimport { FormHandles } from '@unform/core';\nimport { Form } from '@unform/web';\nimport * as Yup from 'yup';\nimport { Link, useHistory } from 'react-router-dom';\n\nimport api from '../../services/api';\n\nimport { useToast } from '../../hooks/toast';\n\nimport getValidationErrors from '../../utils/getValidationErrors';\n\nimport Input from '../../components/Input';\nimport Button from '../../components/Button';\n\nimport { Container, Content } from './styles';\nimport { useAuth } from '../../hooks/auth';\n\ninterface ProfileFormData {\n  name: string;\n  email: string;\n  old_password: string;\n  password: string;\n  password_confirmation: string;\n}\n\nconst Profile: React.FC = () => {\n  const formRef = useRef<FormHandles>(null);\n  const { addToast } = useToast();\n  const history = useHistory();\n\n  const { user, updateUser } = useAuth();\n\n  const handleSubmit = useCallback(\n    async (data: ProfileFormData) => {\n      try {\n        formRef.current?.setErrors({});\n\n        const schema = Yup.object().shape({\n          name: Yup.string().required('Name mandatory'),\n          email: Yup.string()\n            .email('Insert a valid email')\n            .required('E-mail mandatory'),\n          old_password: Yup.string(),\n          password: Yup.string().when('old_password', {\n            is: (val: any) => !!val.length,\n            then: Yup.string().required('Mandatory field'),\n            otherwise: Yup.string(),\n          }),\n          password_confirmation: Yup.string()\n            .when('old_password', {\n              is: (val: any) => !!val.length,\n              then: Yup.string().required('Mandatory field'),\n              otherwise: Yup.string(),\n            })\n            .oneOf([Yup.ref('password'), undefined], 'Passwords must match'),\n        });\n\n        await schema.validate(data, {\n          abortEarly: false,\n        });\n\n        const {\n          name,\n          email,\n          old_password,\n          password,\n          password_confirmation,\n        } = data;\n\n        const formData = {\n          name,\n          email,\n          ...(data.old_password\n            ? {\n                old_password,\n                password,\n                password_confirmation,\n              }\n            : {}),\n        };\n\n        const response = await api.put('/profile', formData);\n\n        updateUser(response.data);\n\n        history.push('/');\n\n        addToast({\n          type: 'success',\n          title: 'Profile updated successfully!',\n          description: 'Your new settings have been saved',\n        });\n      } catch (err) {\n        if (err instanceof Yup.ValidationError) {\n          const errors = getValidationErrors(err);\n\n          formRef.current?.setErrors(errors);\n\n          return;\n        }\n\n        addToast({\n          type: 'error',\n          title: 'Update error',\n          description:\n            'An error occurred while trying to update your profile, please try again.',\n        });\n      }\n    },\n    [addToast, history, updateUser],\n  );\n\n  return (\n    <Container>\n      <header>\n        <div>\n          <Link to=\"/dashboard\">\n            <FiArrowLeft />\n          </Link>\n        </div>\n      </header>\n\n      <Content>\n        <Form\n          ref={formRef}\n          initialData={{\n            name: user.name,\n            email: user.email,\n          }}\n          onSubmit={handleSubmit}\n        >\n          <h1>My profile</h1>\n\n          <Input name=\"name\" icon={FiUser} placeholder=\"Name\" />\n\n          <Input name=\"email\" icon={FiMail} placeholder=\"E-mail\" />\n\n          <Input\n            containerStyle={{ marginTop: 24 }}\n            name=\"old_password\"\n            icon={FiLock}\n            type=\"password\"\n            placeholder=\"Current password\"\n          />\n\n          <Input\n            name=\"password\"\n            icon={FiLock}\n            type=\"password\"\n            placeholder=\"New password\"\n          />\n\n          <Input\n            name=\"password_confirmation\"\n            icon={FiLock}\n            type=\"password\"\n            placeholder=\"Password confirmation\"\n          />\n\n          <Button type=\"submit\">Confirm changes</Button>\n        </Form>\n      </Content>\n    </Container>\n  );\n};\n\nexport default Profile;\n"]},"metadata":{},"sourceType":"module"}